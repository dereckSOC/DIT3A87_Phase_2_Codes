<%- include("../partials/header") %>

    <!-- price range slider -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
    <!-- price range slider -->

    <!--Map-->
    <div id="map" style="width: 80%; height: 300px;"></div>

    <!-- No Match -->
    <div class="container">
        <% if(noMatch !== undefined){ %>
            <form action="/listings" method="GET" class="form-inline">
                <div class="form-group">
                    <input type="text" class="form-control" name="search" placeholder="listing search...">
                    <input type="submit" value="Search" class="btn btn-info">
                </div>
            </form>
            <h3><%= noMatch %></h3>
        <% } %>

            <div class="d-flex justify-content-around">
                <div class="col-sm-4">
                    <div class="form-card">
                        <div class="form-card-container">
                            <form action="/listings" method="GET" id="filterForm">
                                <p>Filter</p><br>

                                <!-- Filter: Property Type-->
                                <!-- <label for="type">Choose Property Type:</label>
                                <select name="type" id="type">
                                    <option value="" disabled selected hidden>Property Type</option>
                                    <option value="HDB">HDB</option>
                                    <option value="Condo">Condo</option>
                                    <option value="Landed">Landed</option>
                                </select> -->
                                <label for="propertyType">Choose a property type:</label><br>
                                <input type="checkbox" id="hdb" name="hdbType" value="hdb" <% if(data.hdbType) {%> checked <%} %>>
                                <label for="hdb">HDB</label><br>
                                <input type="checkbox" id="condo" name="condoType" value="condo"<% if(data.condoType) {%> checked <%} %>> 
                                <label for="condo">Condo</label><br>
                                <input type="checkbox" id="landed" name="landedType" value="landed" <% if(data.landedType) {%> checked <%} %>>
                                <label for="landed">Landed</label><br>

                                <!-- Filter: Property district -->
                                <br><label for="propertyStatus">Choose a District:</label><br>
                                <input type="checkbox" id="north" name="northDistrict" value="north" <% if(data.northDistrict) {%> checked <%} %>>
                                <label for="north">North</label><br>
                                <input type="checkbox" id="south" name="southDistrict" value="south" <% if(data.southDistrict) {%> checked <%} %>>
                                <label for="south">South</label><br>
                                <input type="checkbox" id="east" name="eastDistrict" value="east" <% if(data.eastDistrict) {%> checked <%} %>>
                                <label for="east">East</label><br>
                                <input type="checkbox" id="west" name="westDistrict" value="west" <% if(data.westDistrict) {%> checked <%} %>>
                                <label for="west">West</label><br>

                                <!-- Filter: Number of rooms slider -->
                                <!-- <label for="numofRooms">Number of Rooms:</label>
                                <select name="numofRooms" id="numofRooms">
                                    <option value="" disabled selected hidden>Rooms</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                </select> -->
                                <br><label for="numofRooms">Number of rooms:</label><br>
                                <input type="checkbox" id="1" name="onerooms" value="1" <% if(data.onerooms) {%> checked <%} %>>
                                <label for="1">1</label><br>
                                <input type="checkbox" id="2" name="tworooms" value="2" <% if(data.tworooms) {%> checked <%} %>>
                                <label for="2">2</label><br>
                                <input type="checkbox" id="3" name="threerooms" value="3" <% if(data.threerooms) {%> checked <%} %>>
                                <label for="3">3</label><br>
                                <input type="checkbox" id="4" name="fourrooms" value="4" <% if(data.fourrooms) {%> checked <%} %>>
                                <label for="4">4</label><br>
                                <input type="checkbox" id="5" name="fiverooms" value="5" <% if(data.fiverooms) {%> checked <%} %>>
                                <label for="5">5</label><br>
                                <input type="checkbox" id="6" name="sixrooms" value="6" <% if(data.sixrooms) {%> checked <%} %>>
                                <label for="6">6</label><br>

                                <!-- Filter: Number of bathrooms -->
                                <br><label for="numofRooms">Number of bath rooms:</label><br>
                                <input type="checkbox" id="1bath" name="onebathrooms" value="1" <% if(data.onebathrooms) {%> checked <%} %>>
                                <label for="1bath">1</label><br>
                                <input type="checkbox" id="2bath" name="twobathrooms" value="2" <% if(data.twobathrooms) {%> checked <%} %>>
                                <label for="2bath">2</label><br>
                                <input type="checkbox" id="3bath" name="threebathrooms" value="3" <% if(data.threebathrooms) {%> checked <%} %>>
                                <label for="3bath">3</label><br>

                                <!-- Filter: Tenure type -->
                                <label for="propertyType">Choose a property type:</label><br>
                                <input type="checkbox" id="freehold" name="freehold" value="freehold" <% if(data.freehold) {%> checked <%} %>>
                                <label for="freehold">Freehold</label><br>
                                <input type="checkbox" id="NinetyNineYL" name="NinetyNineYL" value="ninetynine"<% if(data.NinetyNineYL) {%> checked <%} %>> 
                                <label for="NinetyNineYL">99-Year Leasehold</label><br>
                                <input type="checkbox" id="HundredThreeYL" name="HundredThreeYL" value="hundredthree" <% if(data.HundredThreeYL) {%> checked <%} %>>
                                <label for="HundredThreeYL">103-Year Leasehold</label><br>
                                <input type="checkbox" id="HundredTenYL" name="HundredTenYL" value="hundredten" <% if(data.HundredTenYL) {%> checked <%} %>>
                                <label for="HundredTenYL">110-Year Leasehold</label><br>
                                <input type="checkbox" id="NineHundredNineYL" name="ninehundrednine" value="999"<% if(data.NineHundredNineYL) {%> checked <%} %>> 
                                <label for="NineHundredNineYL">999-Year Leasehold</label><br>
                                <input type="checkbox" id="tenure" name="tenure" value="unknown" <% if(data.tenure) {%> checked <%} %>>
                                <label for="tenure">Unknown Tenure</label><br>

                                <!-- Filter: Price Slider -->
                                <div class="price-slider">
                                    <span>Price: 
                                        <input type="number" value="0" min="0" max="<%= largestPrice %>" name="minPrice" /> to
                                        <input type="number" value="<%= largestPrice %>" min="0" max="<%= largestPrice %>" name="maxPrice" />
                                    </span>
                                    <input type="range" value="0" min="0" max="<%= largestPrice %>" step="500" />
                                    <input type="range" value="<%= largestPrice %>" min="0" max="<%= largestPrice %>" step="500" />
                                    <svg width="100%" height="24">
                                        <!-- <line x1="4" y1="0" x2="300" y2="0" stroke="#212121" stroke-width="12"
                                            stroke-dasharray="1 28">
                                        </line> -->
                                    </svg>
                                </div>

                                <!-- Filter: Size Slider -->
                                <div class="size-slider">
                                    <span>Size: 
                                        <input type="number" value="0" min="0" max="<%= largestSize %>" name="minSize" /> to
                                        <input type="number" value="<%= largestSize %>" min="0" max="<%= largestSize %>" name="maxSize" />
                                    </span>
                                    <input type="range" value="0" min="0" max="<%= largestSize %>" step="500" />
                                    <input type="range" value="<%= largestSize %>" min="0" max="<%= largestSize %>" step="500" />
                                    <svg width="100%" height="24">
                                        <!-- <line x1="4" y1="0" x2="300" y2="0" stroke="#212121" stroke-width="12"
                                            stroke-dasharray="1 28">
                                        </line> -->
                                    </svg>
                                </div>

                                <!-- Filter: Sort by highest or lowest price -->
                                <label for="sortPrice">Sort by:</label>
                                <select name="sortPrice" id="sortPrice">
                                    <option value="" disabled selected hidden>Price</option>
                                    <option value="HighestPrice" <% if(data.sortPrice == 'HighestPrice') {%> selected <%} %>>Highest Price</option>
                                    <option value="LowestPrice" <% if(data.sortPrice == 'LowestPrice') {%> selected <%} %>>Lowest Price</option>
                                </select>

                                <!-- Filter: Sort by recent/oldest -->
                                <br><label for="sortDate">Sort by:</label>
                                <select name="sortDate" id="sortDate">
                                    <option value="" disabled selected hidden>Date</option>
                                    <option value="Recent" <% if(data.sortDate == 'Recent') {%> selected <%} %>>Recent</option>
                                    <option value="Oldest" <% if(data.sortDate == 'Oldest') {%> selected <%} %>>Oldest</option>
                                </select>

                                  <!-- Filter: sort by Most/Least popular listing -->
                                <br><label for="sortPop">Sort by:</label>
                                <select name="sortPop" id="sortPop">
                                    <option value="" disabled selected hidden>Popularity</option>
                                    <option value="MostPop" <% if(data.sortPop == 'MostPop') {%> selected <%} %>>Most Popular</option>
                                    <option value="LeastPop" <% if(data.sortPop == 'LeastPop') {%> selected <%} %>>Least Popular</option>
                                </select>

                                <!-- Filter: for admin/agent to view sold/archived listing -->
                                <% if(currentUser && currentUser.isAdmin || currentUser && currentUser.isAgent && currentUser.agentStatus){ %>
                                    <!-- sold -->
                                    <br><label for="soldStatusCheck">Sold: </label><br>
                                    <input type="checkbox" id="sold" name="soldCheck" value="sold" <% if(data.soldCheck) {%> checked <%} %>>
                                    <label for="sold">Sold Listing</label><br>
                                    <input type="checkbox" id="archive" name="archiveCheck" value="archive" <% if(data.archiveCheck) {%> checked <%} %>>
                                    <label for="archive">Archive listing</label><br>
                                    
                                    <!-- Filter: sort by sold/not sold -->
                                    <br><label for="sortSold">Sort by:</label>
                                    <select name="sortSold" id="sortSold">
                                        <option value="" disabled selected hidden>selling availability</option>
                                        <option value="Sold" <% if(data.sortSold == 'Sold') {%> selected <%} %>>Sold</option>
                                        <option value="NotSold" <% if(data.sortSold == 'NotSold') {%> selected <%} %>>Not Sold</option>
                                    </select>
                                    <!-- Filter: sort by archive/not archive -->
                                    <br><label for="sortArchive">Sort by:</label>
                                    <select name="sortArchive" id="sortArchive">
                                        <option value="" disabled selected hidden>archive availability</option>
                                        <option value="NotArchive" <% if(data.sortArchive == 'NotArchive') {%> selected <%} %>>Not Archive</option>
                                    </select>
                                <% } %>

                                <!-- Filter: reset form inputs -->
                                <br><input type="button" onclick="resetForm()" value="Reset" >

                                <!-- Apply filters/submit button -->
                                <br><input type="submit" value="Apply" name="Apply" id="applyFilter">
                                
                            </form>
                        </div>
                    </div>
                </div>
            
            <div class="col-sm-8">
                <div class="all-listing-card">
                    <div class="all-listing-card-container">
                    <p style="color: red;">Different categories (latest/...)</p>
                        <% listings.forEach(function(listing){ %>
                            <a href="/listings/<%= listing._id %>" style="text-decoration: none; color:black;">
                                <div class="indiv-card">
                                    <div class="indiv-card-container">
                                        <div>
                                            <h5><% if(listing.soldStatus == true) {%>SOLD<%} else {%>Available to buy<%} %></h5>
                                            <h6><% if(listing.archiveStatus == true) {%>ARCHIVED<%} else {%>Available to public<%} %></h6>
                                            <h4><%= listing.name %></h4><br>
                                            <img src="<%= listing.thumbnail %>" style="width:30%; height:30%;"><br>
                                            <div>
                                                <span class="badge label-primary">
                                                    <i class="fas fa-thumbs-up"></i>
                                                    <%= listing.likes.length %>
                                                </span><br>
                                                <span>
                                                    <%= moment(listing.createdAt).format('LLLL'); %>
                                                </span>
                                                <p>$<%= listing.price %></p>
                                                <p style="text-transform:capitalize;">District: <%= listing.district %></p>
                                                <p style="text-transform:capitalize;">Type: <%= listing.type %></p>
                                                <p style="text-transform:capitalize;">Size: <%= listing.size %></p>
                                                <p style="text-transform:capitalize;">Number of rooms: <%= listing.bedrooms %></p>
                                            </div>
                                        </div>
                                        <br>
                                    </div>
                                </div>
                            </a>
                        <% }); %>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        const mapToken = '<%- process.env.MAPBOX_TOKEN %>'
        const listings = { features: <%- JSON.stringify(listings) %> }
    </script>
    <script src="/javascripts/clusterMap.js"></script>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js'></script>
    <script>
            (function () {

                var parent = document.querySelector(".price-slider");
                if (!parent) return;

                var
                    rangeS = parent.querySelectorAll("input[type=range]"),
                    numberS = parent.querySelectorAll("input[type=number]");

                rangeS.forEach(function (el) {
                    el.oninput = function () {
                        var slide1 = parseFloat(rangeS[0].value),
                            slide2 = parseFloat(rangeS[1].value);

                        if (slide1 > slide2) {
                            [slide1, slide2] = [slide2, slide1];
                        }

                        numberS[0].value = slide1;
                        numberS[1].value = slide2;
                    }
                });

                numberS.forEach(function (el) {
                    el.oninput = function () {
                        var number1 = parseFloat(numberS[0].value),
                            number2 = parseFloat(numberS[1].value);

                        if (number1 > number2) {
                            var tmp = number1;
                            numberS[0].value = number2;
                            numberS[1].value = tmp;
                        }

                        rangeS[0].value = number1;
                        rangeS[1].value = number2;

                    }
                });

            })();
    </script>
    <script>
        (function () {

            var parent = document.querySelector(".size-slider");
            if (!parent) return;

            var
                rangeS = parent.querySelectorAll("input[type=range]"),
                numberS = parent.querySelectorAll("input[type=number]");

            rangeS.forEach(function (el) {
                el.oninput = function () {
                    var slide1 = parseFloat(rangeS[0].value),
                        slide2 = parseFloat(rangeS[1].value);

                    if (slide1 > slide2) {
                        [slide1, slide2] = [slide2, slide1];
                    }

                    numberS[0].value = slide1;
                    numberS[1].value = slide2;
                }
            });

            numberS.forEach(function (el) {
                el.oninput = function () {
                    var number1 = parseFloat(numberS[0].value),
                        number2 = parseFloat(numberS[1].value);

                    if (number1 > number2) {
                        var tmp = number1;
                        numberS[0].value = number2;
                        numberS[1].value = tmp;
                    }

                    rangeS[0].value = number1;
                    rangeS[1].value = number2;

                }
            });

        })();
    </script>
    <script>                               
        function resetForm() {
            //document.getElementById("formFilter").resetForm()
            //property type
            document.getElementById("hdb").checked=false;
            document.getElementById("condo").checked=false;
            document.getElementById("landed").checked=false;
            //District type
            document.getElementById("north").checked=false;
            document.getElementById("south").checked=false;
            document.getElementById("east").checked=false;
            document.getElementById("west").checked=false;
            //rooms
            document.getElementById("1").checked=false;
            document.getElementById("2").checked=false;
            document.getElementById("3").checked=false;
            document.getElementById("4").checked=false;
            document.getElementById("5").checked=false;
            document.getElementById("6").checked=false;
            //sort by price
            document.getElementById("sortPrice").value="";
            //sort by date
            document.getElementById("sortDate").value="";
            //sort by popularity
            document.getElementById("sortPop").value="";
            //sold/archive
            // document.getElementById("sold").checked=false;
            // document.getElementById("notsold").checked=false;
            // document.getElementById("archive").checked=false;
            // document.getElementById("notarchive").checked=false;
            //sort by sold
            document.getElementById("sortSold").value="";
            //sort by archive
            document.getElementById("sortArchive").value="";
        }                
    </script>
    
<%- include("../partials/footer") %>