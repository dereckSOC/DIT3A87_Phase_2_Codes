<%- include("../partials/header") %>

    <!-- price range slider -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
    <!-- price range slider -->

    <% if(currentUser && currentUser.isAdmin){ %>
        <h1>You're an admin!</h1>
    <% } else if (currentUser && currentUser.isAgent && currentUser.agentStatus){ %>
        <h1>You're an agent!</h1>
    <% } %>

    <p style="color: red;">Have virtual background as banner???</p>
    <p style="color: red;">Mouse-Hover pattern (futuristic)???</p>

    <!-- No Match -->
    <div class="container">
        <% if(noMatch !== undefined){ %>
            <form action="/listings" method="GET" class="form-inline">
                <div class="form-group">
                    <input type="text" class="form-control" name="search" placeholder="listing search...">
                    <input type="submit" value="Search" class="btn btn-info">
                </div>
            </form>
            <h3><%= noMatch %></h3>
        <% } %>

        <% if(currentUser && currentUser.isAdmin || currentUser && currentUser.isAgent && currentUser.agentStatus){ %>
            <a href="/listings/new">Add New listing</a>
            <% } %>

            <div id="map" style="width: 70%; height: 500px;"></div>

            <div class="d-flex justify-content-around">
                <div class="col-sm-4">
                    <div class="form-card">
                        <div class="form-card-container">
                            <form action="/listings" method="GET" id="filterForm">
                                <p>Filter</p><br>

                                <!-- 1st Filter: Property Type-->
                                <!-- <label for="type">Choose Property Type:</label>
                                <select name="type" id="type">
                                    <option value="" disabled selected hidden>Property Type</option>
                                    <option value="HDB">HDB</option>
                                    <option value="Condo">Condo</option>
                                    <option value="Landed">Landed</option>
                                </select> -->
                                <label for="propertyType">Choose a property type:</label><br>
                                <input type="checkbox" id="hdb" name="hdbType" value="hdb" <% if(data.hdbType) {%> checked <%} %>>
                                <label for="hdb">HDB</label><br>
                                <input type="checkbox" id="condo" name="condoType" value="condo"<% if(data.condoType) {%> checked <%} %>> 
                                <label for="condo">Condo</label><br>
                                <input type="checkbox" id="landed" name="landedType" value="landed" <% if(data.landedType) {%> checked <%} %>>
                                <label for="landed">Landed</label><br>

                                <!-- 2nd Filter: Property Zone -->
                                <br><label for="propertyStatus">Choose a Zone:</label><br>
                                <input type="checkbox" id="north" name="northZone" value="north" <% if(data.northZone) {%> checked <%} %>>
                                <label for="north">North</label><br>
                                <input type="checkbox" id="south" name="southZone" value="south" <% if(data.southZone) {%> checked <%} %>>
                                <label for="south">South</label><br>
                                <input type="checkbox" id="east" name="eastZone" value="east" <% if(data.eastZone) {%> checked <%} %>>
                                <label for="east">East</label><br>
                                <input type="checkbox" id="west" name="westZone" value="west" <% if(data.westZone) {%> checked <%} %>>
                                <label for="west">West</label><br>

                                <!-- 6th filter: Number of rooms slider -->
                                <!-- <label for="numofRooms">Number of Rooms:</label>
                                <select name="numofRooms" id="numofRooms">
                                    <option value="" disabled selected hidden>Rooms</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                </select> -->
                                <br><label for="numofRooms">Number of rooms:</label><br>
                                <input type="checkbox" id="1" name="onerooms" value="1" <% if(data.onerooms) {%> checked <%} %>>
                                <label for="1">1</label><br>
                                <input type="checkbox" id="2" name="tworooms" value="2" <% if(data.tworooms) {%> checked <%} %>>
                                <label for="2">2</label><br>
                                <input type="checkbox" id="3" name="threerooms" value="3" <% if(data.threerooms) {%> checked <%} %>>
                                <label for="3">3</label><br>
                                <input type="checkbox" id="4" name="fourrooms" value="4" <% if(data.fourrooms) {%> checked <%} %>>
                                <label for="4">4</label><br>
                                <input type="checkbox" id="5" name="fiverooms" value="5" <% if(data.fiverooms) {%> checked <%} %>>
                                <label for="5">5</label><br>
                                <input type="checkbox" id="6" name="sixrooms" value="6" <% if(data.sixrooms) {%> checked <%} %>>
                                <label for="6">6</label><br>

                                <!-- 3rd Filter: Price Slider -->
                                <div class="price-slider">
                                    <span>Price: 
                                        <input type="number" value="0" min="0" max="<%= largestPrice %>" name="minPrice" /> to
                                        <input type="number" value="<%= largestPrice %>" min="0" max="<%= largestPrice %>" name="maxPrice" />
                                    </span>
                                    <input type="range" value="0" min="0" max="<%= largestPrice %>" step="500" />
                                    <input type="range" value="<%= largestPrice %>" min="0" max="<%= largestPrice %>" step="500" />
                                    <svg width="100%" height="24">
                                        <!-- <line x1="4" y1="0" x2="300" y2="0" stroke="#212121" stroke-width="12"
                                            stroke-dasharray="1 28">
                                        </line> -->
                                    </svg>
                                </div>

                                <!-- 4th Filter: Size Slider -->
                                <div class="size-slider">
                                    <span>Size: 
                                        <input type="number" value="0" min="0" max="<%= largestSize %>" name="minSize" /> to
                                        <input type="number" value="<%= largestSize %>" min="0" max="<%= largestSize %>" name="maxSize" />
                                    </span>
                                    <input type="range" value="0" min="0" max="<%= largestSize %>" step="500" />
                                    <input type="range" value="<%= largestSize %>" min="0" max="<%= largestSize %>" step="500" />
                                    <svg width="100%" height="24">
                                        <!-- <line x1="4" y1="0" x2="300" y2="0" stroke="#212121" stroke-width="12"
                                            stroke-dasharray="1 28">
                                        </line> -->
                                    </svg>
                                </div>

                                <!-- 5th filter: Sort by highest or lowest price -->
                                <label for="sortPrice">Sort by:</label>
                                <select name="sortPrice" id="sortPrice">
                                    <option value="" disabled selected hidden>Price</option>
                                    <option value="HighestPrice" <% if(data.sortPrice == 'HighestPrice') {%> selected <%} %>>Highest Price</option>
                                    <option value="LowestPrice" <% if(data.sortPrice == 'LowestPrice') {%> selected <%} %>>Lowest Price</option>
                                </select>

                                <!-- 7th filter: Sort by recent/oldest -->
                                <br><label for="sortDate">Sort by:</label>
                                <select name="sortDate" id="sortDate">
                                    <option value="" disabled selected hidden>Date</option>
                                    <option value="Recent" <% if(data.sortDate == 'Recent') {%> selected <%} %>>Recent</option>
                                    <option value="Oldest" <% if(data.sortDate == 'Oldest') {%> selected <%} %>>Oldest</option>
                                </select>

                                <!-- 8th filter: reset form inputs -->
                                <br><input type="submit" onclick="resetForm()" value="Reset" >

                                <!-- Apply filters/submit button -->
                                <br><input type="submit" value="Apply" name="Apply" id="applyFilter">
                                
                            </form>
                        </div>
                    </div>
                </div>
            
            <div class="col-sm-8">
                <div class="all-listing-card">
                    <div class="all-listing-card-container">
                    <p style="color: red;">Different categories (latest/...)</p>
                        <% listings.forEach(function(listing){ %>
                            <a href="/listings/<%= listing._id %>" style="text-decoration: none; color:black;">
                                <div class="indiv-card">
                                    <div class="indiv-card-container">
                                        <div>
                                            <h4><%= listing.name %></h4><br>
                                            <img src="<%= listing.thumbnail %>" style="width:30%; height:30%;"><br>
                                            <div>
                                                <span class="badge label-primary">
                                                    <i class="fas fa-thumbs-up"></i>
                                                    <%= listing.likes.length %>
                                                </span><br>
                                                <span>
                                                    <%= moment(listing.createdAt).format('LLLL'); %>
                                                </span>
                                                <p>$<%= listing.price %></p>
                                                <p style="text-transform:capitalize;">Zone: <%= listing.zone %></p>
                                                <p style="text-transform:capitalize;">Type: <%= listing.type %></p>
                                                <p style="text-transform:capitalize;">Size: <%= listing.size %></p>
                                                <p style="text-transform:capitalize;">Number of rooms: <%= listing.numofRooms %></p>
                                            </div>
                                        </div>
                                        <br>
                                    </div>
                                </div>
                            </a>
                        <% }); %>
                    </div>
                </div>
            </div>
        </div>
        
        <nav aria-label="Page navigation">
            <% if (pages && pages> 0) { %>
                <ul class="pagination justify-content-center">
                    <% if (current==1) { %>
                        <li class="page-item disabled"><a class="page-link">First</a></li>
                    <% } else { %>
                        <li>
                            <a class="page-link" href="/listings<%if(search){%>?search=<%=search%><%}%>">First</a>
                        </li>
                    <% } %>

                    <% if (current==1) { %>
                        <li class="page-item disabled">
                            <a class="page-link">«</a>
                        </li>
                    <% } else { %>
                        <li>
                            <a class="page-link" href="/listings?page=<%= Number(current) - 1 %><%if(search){%>&search=<%=search%><%}%>">«</a>
                        </li>
                    <% } %>

                    <% var i=(Number(current)> 5 ? Number(current) - 4 : 1) %>
                    <% if (i !==1) { %>
                        <li class="page-item disabled">
                            <a class="page-link">...</a>
                        </li>
                    <% } %>

                    <% for (; i <=(Number(current) + 4) && i <=pages; i++) { %>
                        <% if (i==current) { %>
                            <li class="active">
                                <a class="page-link">
                                    <%= i %>
                                </a>
                            </li>
                        <% } else { %>
                            <li>
                                <a class="page-link" href="/listings?page=<%= i %><%if(search){%>&search=<%=search%><%}%>">
                                    <%= i %>
                                </a>
                            </li>
                        <% } %>
                        <% if (i==Number(current) + 4 && i < pages) { %>
                            <li class="page-item disabled">
                                <a class="page-link">...</a>
                            </li>
                        <% } %>
                    <% } %>

                    <% if (current==pages) { %>
                        <li class="page-item disabled">
                            <a class="page-link">»</a>
                        </li>
                    <% } else { %>
                        <li>
                            <a class="page-link" href="/listings?page=<%= Number(current) + 1 %><%if(search){%>&search=<%=search%><%}%>">»</a>
                        </li>
                    <% } %>

                    <% if (current==pages) { %>
                        <li class="page-item disabled">
                            <a class="page-link">Last</a>
                        </li>
                    <% } else { %>
                        <li>
                            <a class="page-link" href="/listings?page=<%= pages %><%if(search){%>&search=<%=search%><%}%>">Last</a>
                        </li>
                    <% } %>
                </ul>
            <% } %>
        </nav>
    </div>


    <script>
        const mapToken = '<%- process.env.MAPBOX_TOKEN %>'
        const listings = { features: <%- JSON.stringify(listings) %> }
    </script>
    <script src="/javascripts/clusterMap.js"></script>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js'></script>
    <script>
            (function () {

                var parent = document.querySelector(".price-slider");
                if (!parent) return;

                var
                    rangeS = parent.querySelectorAll("input[type=range]"),
                    numberS = parent.querySelectorAll("input[type=number]");

                rangeS.forEach(function (el) {
                    el.oninput = function () {
                        var slide1 = parseFloat(rangeS[0].value),
                            slide2 = parseFloat(rangeS[1].value);

                        if (slide1 > slide2) {
                            [slide1, slide2] = [slide2, slide1];
                        }

                        numberS[0].value = slide1;
                        numberS[1].value = slide2;
                    }
                });

                numberS.forEach(function (el) {
                    el.oninput = function () {
                        var number1 = parseFloat(numberS[0].value),
                            number2 = parseFloat(numberS[1].value);

                        if (number1 > number2) {
                            var tmp = number1;
                            numberS[0].value = number2;
                            numberS[1].value = tmp;
                        }

                        rangeS[0].value = number1;
                        rangeS[1].value = number2;

                    }
                });

            })();
    </script>
    <script>
        (function () {

            var parent = document.querySelector(".size-slider");
            if (!parent) return;

            var
                rangeS = parent.querySelectorAll("input[type=range]"),
                numberS = parent.querySelectorAll("input[type=number]");

            rangeS.forEach(function (el) {
                el.oninput = function () {
                    var slide1 = parseFloat(rangeS[0].value),
                        slide2 = parseFloat(rangeS[1].value);

                    if (slide1 > slide2) {
                        [slide1, slide2] = [slide2, slide1];
                    }

                    numberS[0].value = slide1;
                    numberS[1].value = slide2;
                }
            });

            numberS.forEach(function (el) {
                el.oninput = function () {
                    var number1 = parseFloat(numberS[0].value),
                        number2 = parseFloat(numberS[1].value);

                    if (number1 > number2) {
                        var tmp = number1;
                        numberS[0].value = number2;
                        numberS[1].value = tmp;
                    }

                    rangeS[0].value = number1;
                    rangeS[1].value = number2;

                }
            });

        })();
    </script>
    <script>
        (function () {

            var parent = document.querySelector(".numofRooms-slider");
            if (!parent) return;

            var
                rangeS = parent.querySelectorAll("input[type=range]"),
                numberS = parent.querySelectorAll("input[type=number]");

            rangeS.forEach(function (el) {
                el.oninput = function () {
                    var slide1 = parseFloat(rangeS[0].value);

                    numberS[0].value = slide1;
                }
            });

            numberS.forEach(function (el) {
                el.oninput = function () {
                    var number1 = parseFloat(numberS[0].value);

                    rangeS[0].value = number1;

                }
            });

        })();
    </script>
    <script>
        function upperCaseFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }
    </script>
    <script>                               
        function resetForm() {
            //document.getElementById("formFilter").resetForm()
            //property type
            document.getElementById("hdb").checked=false;
            document.getElementById("condo").checked=false;
            document.getElementById("landed").checked=false;
            //zone type
            document.getElementById("north").checked=false;
            document.getElementById("south").checked=false;
            document.getElementById("east").checked=false;
            document.getElementById("west").checked=false;
            //rooms
            document.getElementById("1").checked=false;
            document.getElementById("2").checked=false;
            document.getElementById("3").checked=false;
            document.getElementById("4").checked=false;
            document.getElementById("5").checked=false;
            document.getElementById("6").checked=false;
            //sort by price
            document.getElementById("sortPrice").value="";
            //sort by date
            document.getElementById("sortDate").value="";
        }                
    </script>

    
<%- include("../partials/footer") %>