<%- include("../partials/header") %>

    <h1>pp</h1>
    <form action="/listings/A" method="GET" class="form-inline">
        <div class="form-group">
          <input type="text" class="form-control" name="search" placeholder="listing search...">
          <input type="submit" value="Search" class="btn btn-info">
        </div>
      </form>

    <div class="d-flex justify-content-around">
        <div class="col-sm-4">
            <div class="card">
                <div class="card-container">
                    <form action="/listings/A" method="GET">
                        <p>Filter</p><br>
                        <!-- 1st Filter -->
                        <label for="propertyType">Choose Property Type:</label>
                        <select name="propertyType" id="propertyType">
                            <option value="" disabled selected hidden>Property Type</option>
                            <option value="HDB">HDB</option>
                            <option value="Condo">Condo</option>
                            <option value="Landed">Landed</option>
                        </select>
                        <!-- 2nd Filter -->
                        <br><label for="propertyStatus">Something:</label><br>
                        <input type="checkbox" id="newLaunch" name="propertyStatus" value="newLaunch">
                        <label for="newLaunch">New Launch</label><br>
                        <input type="checkbox" id="resale" name="propertyStatus" value="resale">
                        <label for="resale">Resale</label><br>
                        <!-- 3rd Filter -->
                        <div class="price-slider">
                            <span>from
                                <input type="number" value="5000" min="0" max="120000" name="minPrice"/> to
                                <input type="number" value="50000" min="0" max="120000" name="maxPrice"/>
                            </span>
                            <input type="range" value="25000" min="0" max="120000" step="500"/>
                            <input type="range" value="50000" min="0" max="120000" step="500"/>
                            <svg width="100%" height="24">
                                <line x1="4" y1="0" x2="300" y2="0" stroke="#212121" stroke-width="12"
                                    stroke-dasharray="1 28">
                                </line>
                            </svg>
                        </div>

                        <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js'></script>
                        <script>
                            (function () {

                                var parent = document.querySelector(".price-slider");
                                if (!parent) return;

                                var
                                    rangeS = parent.querySelectorAll("input[type=range]"),
                                    numberS = parent.querySelectorAll("input[type=number]");

                                rangeS.forEach(function (el) {
                                    el.oninput = function () {
                                        var slide1 = parseFloat(rangeS[0].value),
                                            slide2 = parseFloat(rangeS[1].value);

                                        if (slide1 > slide2) {
                                            [slide1, slide2] = [slide2, slide1];
                                        }

                                        numberS[0].value = slide1;
                                        numberS[1].value = slide2;
                                    }
                                });

                                numberS.forEach(function (el) {
                                    el.oninput = function () {
                                        var number1 = parseFloat(numberS[0].value),
                                            number2 = parseFloat(numberS[1].value);

                                        if (number1 > number2) {
                                            var tmp = number1;
                                            numberS[0].value = number2;
                                            numberS[1].value = tmp;
                                        }

                                        rangeS[0].value = number1;
                                        rangeS[1].value = number2;

                                    }
                                });

                            })();
                        </script>
                        <!-- form submit button -->
                        <input type="submit" value="Apply" name="Apply">
                    </form>
                </div>
            </div>
        </div>

        <div class="col-sm-8">
            <div class="listing-card">
                <div class="listing-card-container">
                    <% listings.forEach(function(listing){ %>
                        <a href="/listings/<%= listing._id %>" style="text-decoration: none; color:black;">
                        <div class="indiv-card">
                            <div class="indiv-card-container">
                                <div>
                                    <h4>
                                        <%= listing.name %>
                                    </h4><br>
                                    <img src="<%= listing.image %>" style="width:30%; height:30%;"><br>
                                    <div>
                                        <span class="badge label-primary"><i class="fas fa-thumbs-up"></i>
                                            <%= listing.likes.length %>
                                        </span><br>
                                        <span>
                                            <%= moment(listing.createdAt).format('LLLL'); %>
                                        </span>
                                    </div>
                                    <div>
                                        <p>
                                          $<%= listing.price %>
                                        </p>
                                      </div>
                                </div>
                                <br>
                               
                            </div>
                        </div>
                    </a>
                        <% }); %>
                </div>
            </div>
        </div>
        
    </div>
    
    <nav aria-label="Page navigation">
        <% if (pages && pages> 0) { %>
          <ul class="pagination justify-content-center">
            <% if (current==1) { %>
              <li class="page-item disabled"><a class="page-link">First</a></li>
              <% } else { %>
                <li><a class="page-link"
                    href="/listings/A<%if(search){%>?search=<%=search%><%}%>">First</a></li>
                <% } %>

                  <% if (current==1) { %>
                    <li class="page-item disabled"><a class="page-link">«</a></li>
                    <% } else { %>
                      <li><a class="page-link"
                          href="/listings/A?page=<%= Number(current) - 1 %><%if(search){%>&search=<%=search%><%}%>">«</a>
                      </li>
                      <% } %>

                        <% var i=(Number(current)> 5 ? Number(current) - 4 : 1) %>
                          <% if (i !==1) { %>
                            <li class="page-item disabled"><a class="page-link">...</a></li>
                            <% } %>
                              <% for (; i <=(Number(current) + 4) && i <=pages; i++) { %>
                                <% if (i==current) { %>
                                  <li class="active"><a class="page-link">
                                      <%= i %>
                                    </a></li>
                                  <% } else { %>
                                    <li><a class="page-link"
                                        href="/listings/A?page=<%= i %><%if(search){%>&search=<%=search%><%}%>">
                                        <%= i %>
                                      </a></li>
                                    <% } %>
                                      <% if (i==Number(current) + 4 && i < pages) { %>
                                        <li class="page-item disabled"><a class="page-link">...</a></li>
                                        <% } %>
                                          <% } %>

                                            <% if (current==pages) { %>
                                              <li class="page-item disabled"><a class="page-link">»</a>
                                              </li>
                                              <% } else { %>
                                                <li><a class="page-link"
                                                    href="/listings/A?page=<%= Number(current) + 1 %><%if(search){%>&search=<%=search%><%}%>">»</a>
                                                </li>
                                                <% } %>

                                                  <% if (current==pages) { %>
                                                    <li class="page-item disabled"><a
                                                        class="page-link">Last</a></li>
                                                    <% } else { %>
                                                      <li><a class="page-link"
                                                          href="/listings/A?page=<%= pages %><%if(search){%>&search=<%=search%><%}%>">Last</a>
                                                      </li>
                                                      <% } %>
          </ul>
          <% } %>
      </nav>

    <%- include("../partials/footer") %>