<%- include("../partials/header") %>

<div style="overflow-x: hidden;" class="pb-4">
  <div class="row">
    <div class="col-3">
      <div class="navigation sticky-top">
        <ul>
          <li class="list active">
            <a href="/user/<%= user._id %>/edit">
              <span class="icon activeText">
                <ion-icon name="create-outline"></ion-icon>
              </span>
              <span class="title activeText">Edit Details</span>
            </a>
          </li>
          <li class="list navigationHover">
            <a href="/user/<%= user._id %>/manage">
              <span class="icon">
                <ion-icon name="settings-outline"></ion-icon>
              </span>
              <span class="title">Manage Account</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="col-6 offset-1 mt-4">
      <form action="/user/<%= user._id %>?_method=PUT" method="POST" enctype="multipart/form-data"
        id="profileEditForm">
        <div class="row">
          <!-- <% if(user.isAgent==false || currentUser && currentUser.isAdmin){ %>
            <div class="col-12" style="height: 240px;">
              <p style="font-weight: 600;">Profile Photo</p>
              <div class="row">
                <div class="col-4">
                  <img src="<%= user.image %>" class="profileImageEdit">
                  <img id="output" class="profileImageEdit" />
                </div>
                <div class="col-8" style="position: relative; top: 40px;">
                  <p style="font-weight: 350; font-size: 0.95em;">
                    Clear frontal face photos are an important way for buyers and sellers to learn about each other.
                  </p>
                  <label for="file-upload-image" class="btn btn-outline-dark customImageUpload px-3 py-1">
                    Upload a Photo
                  </label>
                  <input type="file" id="file-upload-image" name="image" onchange="loadFile(event)" id="imageUpload"
                    accept="image/*">
                </div>
              </div>
            </div>
          <% } %> -->
          <div class="col-12">
            <div class="row">
              <!-- profile pic  -->
              <!-- profile pic  -->
              <div class="col-12" style="height: 240px;">
                <p style="font-weight: 600;">Profile Photo</p>
                <div class="row">
                  <div class="col-6 col-sm-5 col-md-4 editImageMobile">
                    <img src="<%= user.image %>" class="profilePicEdit">
                    <img id="outputProfile" class="profilePicEdit" />
                  </div>
                  <div class="col-6 col-sm-7 col-md-8 d-lg-none editImageMobile" style="padding-top: 30px;">
                    <label for="profile-upload" class="btn btn-outline-dark customImageUpload px-3 py-1">
                      Upload
                    </label>
                  </div>
                  <div class="col-12 col-lg-8 editTextMobile">
                    <p style="font-weight: 350; font-size: 0.95em;">
                      Clear frontal face photos are an important way for buyers and sellers to learn about each other.
                    </p>
                    <label for="profile-upload" class="d-none d-lg-inline btn btn-outline-dark customImageUpload px-3 py-1">
                      Upload
                    </label>
                    <input type="file" id="profile-upload" name="profileImage" onchange="loadProfileFile(event)" accept="image/*">
                  </div>
                </div>
              </div>

              <!-- banner pic  -->
              <div class="col-12" style="height: 240px;">
                <p style="font-weight: 600;">Profile Banner</p>
                <div class="row">
                  <div class="col-4">
                    <img src="<%= user.banner %>" class="profileBannerEdit">
                    <img id="outputBanner" class="profileBannerEdit" />
                  </div>
                  <div class="col-12 col-lg-8" style="position: relative; top: 20px;">
                    <p style="font-weight: 350; font-size: 0.95em;">
                      A profile banner will often be the first impression users have on you, so show your creativity into your banner by personalising it.
                    </p>
                    <label for="banner-upload" class="d-none d-lg-inline btn btn-outline-dark customImageUpload px-3 py-1">
                      Upload
                    </label>
                    <input type="file" id="banner-upload" name="bannerImage" onchange="loadBannerFile(event)" accept="image/*">
                  </div>
                  
                  <div class="col-6 col-sm-7 col-md-8 d-lg-none mt-3" style="padding-top: 35px;">
                    <label for="banner-upload" class="btn btn-outline-dark customImageUpload px-3 py-1">
                      Upload
                    </label>
                  </div>
                </div>
              </div>
              <!-- form -->
              <div class="col-12">
                <p class="my-2" style="font-weight: 600; ">Profile Details</p>
                <label class="custom-field one">
                  <input type="text" name="user[username]" value="<%= user.username %>" placeholder=" "
                    required />
                  <span class="placeholder">Username</span>
                </label>
              </div>
              <div class="col-12">
                <label class="custom-field one">
                  <input type="email" name="user[email]" value="<%= user.email %>" placeholder=" " required />
                  <span class="placeholder">Email</span>
                </label>
              </div>
              <div class="col-12">
                <label class="custom-field one">
                  <input type="number" name="user[phone]" value="<%= user.phone %>" placeholder=" " required />
                  <span class="placeholder">Contact Number</span>
                </label>
              </div>
              <% if(currentUser && currentUser.isAdmin){ %>
                <div class="col-12">
                  <label class="custom-field one">
                    <input type="text" name="user[cea]" value="<%= user.cea %>" placeholder=" " required />
                    <span class="placeholder">CEA Number</span>
                  </label>
                </div>
                <% } %>
                  <div class="col-12">
                    <label class="custom-field one">
                      <input type="text" name="user[streetName]" value="<%= user.streetName %>" placeholder=" "
                        required />
                      <span class="placeholder">Street Name</span>
                    </label>
                  </div>
                  <div class="col-12">
                    <label class="custom-field one">
                      <input type="text" name="user[unitNumber]" value="<%= user.unitNumber %>" placeholder=" " />
                      <span class="placeholder">Unit Number</span>
                    </label>
                  </div>
                  <div class="col-12">
                    <label class="custom-field one">
                      <input type="number" name="user[postalCode]" value="<%= user.postalCode %>" placeholder=" "
                        required />
                      <span class="placeholder">Postal Code</span>
                    </label>
                  </div>
                  <div class="col-12">
                    <label class="custom-field one">
                      <input type="text" name="user[country]" value="<%= user.country %>" placeholder=" "
                        required />
                      <span class="placeholder">Country</span>
                    </label>
                  </div>
                  <div class="col-12">
                    <label class="custom-field one">
                      <input type="text" name="user[state]" value="<%= user.state %>" placeholder=" " required />
                      <span class="placeholder">State</span>
                    </label>
                  </div>
            </div>
          </div>
        </div>

        <div class="mt-3">
          <span class="left">
            <a class="btn btn-secondary profileEditCancel px-4" href="/user/<%= user.id %>">Cancel</a>
          </span>
          <span class="right">
            <button class="btn btn-primary profileEditSubmit px-4">Save Changes</button>
          </span>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- profile upload -->
<script>
  var loadProfileFile = function (event) {
    var profileoutput = document.getElementById('outputProfile');
    profileoutput.src = URL.createObjectURL(event.target.files[0]);
    profileoutput.onload = function () {
      URL.revokeObjectURL(profileoutput.src) // free memory
    }
  };
</script>
<!-- banner upload -->
<script>
  var loadBannerFile = function (event) {
    var banneroutput = document.getElementById('outputBanner');
    banneroutput.src = URL.createObjectURL(event.target.files[0]);
    banneroutput.onload = function () {
      URL.revokeObjectURL(banneroutput.src) // free memory
    }
  };
</script>
<script>
  const list = document.querySelectorAll('.list');
  function activeLink(){
    list.forEach((item) =>
      item.classList.remove('active'));
      this.classList.add('active');
    }
    list.forEach((item) => 
    item.addEventListener('click', activeLink));
</script>
<script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" data-auto-replace-svg="nest"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
  integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
  integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
  integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="/javascripts/owl.carousel.min.js"></script>
<script src="/javascripts/jquer.js"></script>
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script>
<script>
  $(window).on('load', function(){
    $(".loader").fadeOut(1000);
});
</script>
<script>
  function sortTableByColumn(table, column, asc = true) {
      const dirModifier = asc ? 1 : -1;
      const tBody = table.tBodies[0];
      const rows = Array.from(tBody.querySelectorAll("tr"));

      // Sort each row
      const sortedRows = rows.sort((a, b) => {
          const aColText = a.querySelector(`td:nth-child(${ column + 1 })`).textContent.trim();
          const bColText = b.querySelector(`td:nth-child(${ column + 1 })`).textContent.trim();

          return aColText > bColText ? (1 * dirModifier) : (-1 * dirModifier);
      });

      // Remove all existing TRs from the table
      while (tBody.firstChild) {
          tBody.removeChild(tBody.firstChild);
      }

      // Re-add the newly sorted rows
      tBody.append(...sortedRows);

      // Remember how the column is currently sorted
      table.querySelectorAll("th").forEach(th => th.classList.remove("th-sort-asc", "th-sort-desc"));
      table.querySelector(`th:nth-child(${ column + 1})`).classList.toggle("th-sort-asc", asc);
      table.querySelector(`th:nth-child(${ column + 1})`).classList.toggle("th-sort-desc", !asc);
  }

  document.querySelectorAll(".table-sortable th").forEach(headerCell => {
      headerCell.addEventListener("click", () => {
          const tableElement = headerCell.parentElement.parentElement.parentElement;
          const headerIndex = Array.prototype.indexOf.call(headerCell.parentElement.children, headerCell);
          const currentIsAscending = headerCell.classList.contains("th-sort-asc");

          sortTableByColumn(tableElement, headerIndex, !currentIsAscending);
      });
  });
</script>
<script>
  AOS.init();
</script>
</body>

</html>