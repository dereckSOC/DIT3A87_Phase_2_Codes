<%- include("../partials/header") %>
<script src="/javascripts/userSearch.js"></script>
<style>
  body {
    background-color: rgb(247,247,247);
  }
</style>
<script>
  //Get search result set
  var resultSet = `<%- JSON.stringify(users) %>`
</script>

  <div style="position: relative;text-align: center;color: white;">
    <img class="shadow" src="img/findagents-banner.png" style="width:100%;">
    <div class="user-header"><p>Find Property Agents in Singapore</p></div>
  </div>

  <div class="container" style="margin-top: -50px; margin-bottom: 50px">
    <% if(noMatch !==undefined){ %>
      <div class="col-md-12 m-0 p-0">
        <div class="user-search shadow">
          <form action="/user" method="GET" class="form-inline">
            <div class="row col-md-12  form-group">
              <div class="col-md-12 d-flex justify-content-center align-items-center flex-column">
                <div class="row col-md-12  d-flex justify-content-center align-items-center">
                  <input type="text" class="form-control" name="search" placeholder="Search Agent Name or CEA Number">
                  <!-- <select name="zone" id="zone">
                    <option selected hidden>Zone</option>
                    <option>North</option>
                    <option>East</option>
                    <option>South</option>
                    <option>West</option>
                  </select> -->
                </div>
              </div>


              <!-- Sort By, Agent Zone-->
              <input type="submit" value="Show Agents" class="btn btn-info">
            </div>
          </form>
          <form action="/user" method="GET" id="filterAgentForm">
            <!-- Filter: sort by rating -->
            <label for="sortRating">Sort by:</label>
            <select name="sortRating" id="sortRating">
                <option value="" disabled selected hidden>Rating</option>
                <option value="HighestRating" <% if(data.sortRating == 'HighestRating') {%> selected <%} %>>Highest Rating</option>
                <option value="LowestRating" <% if(data.sortRating == 'LowestRating') {%> selected <%} %>>Lowest Rating</option>
            </select>
            <!-- Filter: sort by join date -->
            <label for="sortDate">Sort by:</label>
            <select name="sortDate" id="sortDate">
                <option value="" disabled selected hidden>Date</option>
                <option value="Recent" <% if(data.sortDate == 'Recent') {%> selected <%} %>>Recent</option>
                <option value="Oldest" <% if(data.sortDate == 'Oldest') {%> selected <%} %>>Oldest</option>
            </select>
            
            <!-- Filter: reset form inputs -->
            <input type="button" onclick="resetForm()" value="Reset" >
            <!-- Apply filters/submit button -->
            <input type="submit" value="Apply" name="Apply" id="applyFilter">
          </form>
        </div>
        <h3>
          <%= noMatch %>
        </h3>
      </div>
  <% } %>
  </div>


  <div class="container">
    <main class="row" style="display:flex; flex-wrap: wrap;" id="resultDiv"></main>
  </div>


  <script>
    var loadObj;
    // const URL = "https://gist.githubusercontent.com/prof3ssorSt3v3/1944e7ba7ffb62fe771c51764f7977a4/raw/c58a342ab149fbbb9bb19c94e278d64702833270/infinite.json";
    document.addEventListener("DOMContentLoaded", () => {
        let options = {
            root: null,
            rootMargins: "0px",
            threshold: 0.5
        };
        const observer = new IntersectionObserver(handleIntersect, options);
        observer.observe(document.querySelector("footer"));
        loadObj = loadFirstFive(resultSet)
    });


    function handleIntersect(entries) {
      if (entries[0].isIntersecting) {
      
          setTimeout(function() {
            loadData(resultSet,loadObj);
          }, 1000)
      }
    }

  </script>
  <script> 
          function resetForm() {
            //sort by price
            document.getElementById("sortRating").value="";
            //sort by date
            document.getElementById("sortDate").value="";
        }     
  </script>
  <%- include("../partials/footer") %>